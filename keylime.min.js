(function(e,t){var i,o=t(e);if(typeof define==="function"&&define.amd)define(i=o);if(typeof exports==="object")module.exports=i=o;e.keyLime=o})(typeof global!=="undefined"?global:this,function(e){"use strict";var t,i,o,l,n,r,a,s,c,m=document.createElement("style"),d=document.createElement("div"),f=e.keyLime||{config:{}},u=false,g=[".lime-container { background-color: #333; position: absolute; bottom: 0; left: 0; right: 0; color: #fff; z-index:1000000; }",'.lime-container-dim::before { position: absolute; content: ""; top: 0; left: 0; right: 0; bottom: 0; background-color: #000; opacity: 0.5; }',".lime-key-row { list-style-type: none; clear: both; text-align: center; padding: 0; margin: 0; font-size: 28px; font-weight: bold; }",".lime-diacritics-row { position: absolute; z-index: 2; overflow: hidden; -webkit-transition: width 400ms; transition: width 400ms; white-space: nowrap; }",".lime-key { vertical-align: top; display: inline-block; border: 3px solid #333; background-color: #666; width: 66px; line-height: 50px; -webkit-transition: all 400ms linear; transition: all 400ms linear; }",".lime-key[data-text]::before { content: attr(data-text) }",".lime-container.symbol-toggle .lime-key[data-symbol]::before { content: attr(data-symbol) }",".lime-container.shift-toggle .lime-key[data-text]:not(.lime-http):not(.lime-dotcom):not(.lime-wwwdot)::before { text-transform: uppercase; }",".lime-special-key { background-color: #999; color: #333; }",".lime-return { background-color: #ccc; width: 138px; }",".lime-focus { background-color: #26f; color: #fff; }",".lime-toggle { background-color: #2f2; color: #fff; position: relative; }",".lime-spacebar { width:498px; }",".lime-http, .lime-dotcom, .lime-wwwdot { font-size: 20px; }"],y=/^(?:text|search|url|tel|password)$/i,p=b(),h={Tab:N,Return:B,Shift:function(e){var t=d.querySelector(".lime-toggle");if(t)t.classList.remove("lime-toggle");d.classList.remove("shift-toggle","symbol-toggle");n=r=false;if(o){o=false;l=true;e.classList.add("lime-toggle")}else if(l)l=false;else o=true;if(o||l)d.classList.add("shift-toggle")},Symbol:function(e){var t=d.querySelector(".lime-toggle");if(t)t.classList.remove("lime-toggle");n=!n;o=l=r=false;d.classList.remove("shift-toggle");d.classList.toggle("symbol-toggle");if(n)e.classList.toggle("lime-toggle")},Backspace:function(){if(!D(document.activeElement))return;var e=window.getSelection();if(!String(e).length)e.modify("extend","backward","character");e.deleteFromDocument()},Caret:function(e){var t=d.querySelector(".lime-toggle");if(t)t.classList.remove("lime-toggle");n=o=l=false;d.classList.remove("shift-toggle","symbol-toggle");r=!r;if(r)e.classList.add("lime-toggle")}},v={verbatim:{keys:{standard:[["@","1","2","3","4","5","6","7","8","9","0","-","="],["q","w","e","r","t","y","u","i","o","p","[","]"],["a","s","d","f","g","h","j","k","l",";","'"],["z","x","c","v","b","n","m",",",".","/"]],symbol:[["@","1","2","3","4","5","6","7","8","9","0","-","="],["~","#","`","£","$","%","^","&","(",")","[","]"],["•","€","¥","¡","¿","*","|","{","}",":","&quot;"],["غ","=","!","\\","«","»","§","<",">","?"]]},diacritics:{a:"äáâàåæ",c:"ç©",d:"ð",e:"ëéêè",i:"ïíîì",m:"µ",n:"ñ",o:"öóôòõø",u:"üúûù",y:"ÿý"}}};d.className="lime-container";d.lang="en";document.head.insertBefore(m,document.head.firstChild);for(var w=0;w<g.length;w++)m.sheet.insertRule(g[w],w);function b(){var e=document.createElement("input");e.type="number";try{e.selectionStart=0;return true}catch(t){return false}}function k(){if(!D(document.activeElement))return;document.body.appendChild(d);u=true}function L(){document.body.removeChild(d);u=false}function E(){var e="",t={row2:{before:'<li id="limeTab" class="lime-key lime-special-key lime-tab">⇥</li>',after:'<li id="limeBackspace" class="lime-key lime-special-key lime-backspace">⌫</li>'},row3:{before:'<li id="limeShift" class="lime-key lime-special-key lime-shift">⇑</li>',after:'<li id="limeCaret" class="lime-key lime-special-key lime-caret">|⇄</li>'}},i=v.verbatim.diacritics,o=v.verbatim.keys;e+=o.standard.map(function(e,i){var l=t["row"+i];return'<menu class="lime-key-row">'+(l&&l.before||"")+e.map(function(e,t){return'<li class="lime-key" data-text="'+e+'" data-symbol="'+o.symbol[i][t]+'"></li>'}).join("")+(l&&l.after||"")+"</menu>"}).join("");e+='<menu class="lime-key-row">'+'<li id="limeSymbol" class="lime-key lime-special-key">★</li>'+'<li class="lime-key lime-http" data-text="http://"></li>'+'<li class="lime-key lime-wwwdot" data-text="www."></li>'+'<li class="lime-key lime-spacebar" data-text=" ">&nbsp;</li>'+'<li class="lime-key lime-dotcom" data-text=".com"></li>'+'<li id="limeReturn" class="lime-key lime-special-key lime-return">➥</li>'+"</menu>";d.innerHTML=e}function x(e){if(!e.classList.contains("lime-key"))return;if(i)i.classList.remove("lime-focus");i=e;i.classList.add("lime-focus")}function C(e){var t;if(!i)t=d.querySelector(".lime-key");else if(e==="left"||e==="right"){t=i[(e==="left"?"previous":"next")+"Sibling"];if(!t&&!c)t=i.parentNode[(e==="left"?"last":"first")+"Child"]}else if(!c){var o=i.getBoundingClientRect(),l=i.offsetHeight,n=o.top+(e==="down"?l:-l),r=a;if(!a)r=a=o.left+i.offsetWidth/2;t=document.elementFromPoint(r-10,n);if(!t.classList.contains("lime-key"))t=document.elementFromPoint(r+10,n);if(!t.classList.contains("lime-key"))t=null}if(t){x(t);if(e==="left"||e==="right")a=i.getBoundingClientRect().left+i.offsetWidth/2}else if(c){var o=i.getBoundingClientRect();R();x(document.elementFromPoint(o.left,o.top));a=o.left+i.offsetWidth/2;return C(e)}}function S(){var e,t,r=i,a="toLocaleUpperCase"in String.prototype?"toLocaleUpperCase":"toUpperCase";if(t=h[r.id.slice(4)])return t(r);else{e=r.dataset[n?"symbol":"text"]||r.dataset.text;if(!e)return;if(o||l)e=e[a]();if(o){o=false;d.classList.remove("shift-toggle")}var s=document.activeElement;if(p||y.test(s.type)){var c=s.selectionStart;s.value=s.value.slice(0,c)+e+s.value.slice(s.selectionEnd);s.selectionStart=s.selectionEnd=c+e.length}else{var m,f,u,g=window.getSelection();g.deleteFromDocument();do{m=String(g).length;g.modify("extend","backward","line")}while(String(g).length!==m);f=String(g);g.deleteFromDocument();do{m=String(g).length;g.modify("extend","forward","line")}while(String(g).length!==m);u=String(g);g.deleteFromDocument();s.setAttribute("value",s.defaultValue);s.value=f+e+u;s.select();g=window.getSelection();g.collapseToEnd();while(m-->0)g.modify("move","backward","character")}}}function A(e){e.preventDefault();e.stopPropagation()}function B(){if(document.activeElement.form)document.activeElement.form.submit();L()}function T(){var e,t,o,l,n,r=v.verbatim.diacritics[i&&i.dataset.text];if(!i||!r)return;if(!(e=d.querySelector(".lime-diacritics-row"))){e=document.createElement("menu");e.className="lime-key-row lime-diacritics-row"}d.classList.add("lime-container-dim");i.classList.add("lime-toggle");o=d.getBoundingClientRect();t=i.getBoundingClientRect();l=i.parentNode.lastChild.getBoundingClientRect();e.innerHTML="";Array.prototype.forEach.call(r,function(t){var i=e.appendChild(document.createElement("li"));i.className="lime-key lime-diacritical";i.dataset.text=t});d.appendChild(e);c=e;n=e.offsetWidth;e.style.left=e.style.right="";if(t.right+n<=l.right)e.style.left=t.right-o.left+"px";else e.style.right=o.right-t.left+"px";e.style.top=t.top-o.top+"px";e.style.width=0;window.setTimeout(function(){e.style.width=n+"px"})}function R(){if(!c)return;c.parentNode.removeChild(c);d.classList.remove("lime-container-dim");x(d.querySelector(".lime-toggle[data-text]"));i.classList.remove("lime-toggle");a=i.getBoundingClientRect().left;c=null}function N(){var e,t=Array.prototype.slice.call(document.getElementsByTagName("*"));t=t.filter(function(e){return e.tabIndex>-1});t.sort(function(e,t){return(e.tabIndex||Number.MAX_VALUE)-(t.tabIndex||Number.MAX_VALUE)});e=t[t.indexOf(document.activeElement)+1];if(!e)e=t[0];if(e)e.focus()}function D(e){var t=/^(?:text|email|number|password|tel|url|search)$/,i=/^(?:email|number)$/;return(t.test(e.type)||e.isContentEditable)&&!e.readOnly}document.addEventListener("DOMFocusIn",function(e){var t=e.target.tagName;if(!f.config.noauto&&(e.target.isContentEditable||t==="INPUT"||t==="TEXTAREA"))k()});document.addEventListener("DOMFocusOut",function(e){if(u&&!f.config.noauto)L()});document.addEventListener("keydown",function(e){if(!u)return;var o;switch(e.key){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(r)return;A(e);C(e.key.slice(5).toLowerCase());break;case"Enter":if(!t)t=setTimeout(T,500);A(e);break;case"Escape":case"BrowserBack":A(e);if(r)h.Caret(i);else if(c)R();else L()}},true);document.addEventListener("keypress",function(e){var t=String.fromCharCode(e.keyCode).toLowerCase(),i=d.querySelector('li[data-text="'+t+'"]');if(i){x(i);window.setTimeout(function(){i.classList.remove("lime-focus")},100)}},true);document.addEventListener("keyup",function(e){if(!u)return;var o;switch(e.key){case"Escape":case"BrowserBack":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":A(e);break;case"Enter":A(e);clearTimeout(t);t=null;if(c&&!i.classList.contains("lime-diacritical"))x(c.firstChild);else{S();if(c)R()}}},true);d.addEventListener("mousedown",function(e){A(e);var i=e.target,o=document.activeElement;if(!e.target.classList.contains("lime-key"))return;t=setTimeout(T,500)},true);d.addEventListener("mouseup",function(e){A(e);var i=e.target,o=document.activeElement;if(!e.target.classList.contains("lime-key"))return;clearTimeout(t);t=null;S();if(c)R()},true);d.addEventListener("mousemove",function(e){x(e.target)});d.addEventListener("mouseout",function(e){if(i===e.target)i.classList.remove("lime-focus")});(function(){var t={13:"Enter",27:"Escape",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown"},i={get:function(){var e=this.which;return t[e]||"Unidentified"}};if(e.KeyboardEvent&&!e.KeyboardEvent.prototype.hasOwnProperty("key"))Object.defineProperty(e.KeyboardEvent.prototype,"key",i);if(e.KeyEvent&&!e.KeyEvent.prototype.hasOwnProperty("key"))Object.defineProperty(e.KeyEvent.prototype,"key",i)})(e);E();f.show=k;f.hide=L;return f});