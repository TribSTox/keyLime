!function(e,t){var i,keyLime=t(e);"function"==typeof define&&define.amd&&define(i=keyLime),"object"==typeof exports&&(module.exports=i=keyLime),e.keyLime=keyLime}("undefined"!=typeof global?global:this,function(e){"use strict";function t(){var e=document.createElement("input");e.type="number";try{return e.selectionStart=0,!0}catch(t){return!1}}function i(){g(document.activeElement)&&(clearTimeout(p),!K&&f("keylimeshow")&&(document.body.appendChild(T),K=!0))}function o(){clearTimeout(p),p=setTimeout(function(){K&&f("keylimehide")&&(document.body.removeChild(T),K=!1,v&&(v.classList.remove("lime-focus"),v=null))})}function n(){var e="",t={row2:{before:'<li id="limeTab" class="lime-key lime-special-key lime-tab">Tab</li>',after:'<li id="limeBackspace" class="lime-key lime-special-key lime-backspace">⌫</li>'},row3:{before:'<li id="limeShift" class="lime-key lime-special-key lime-shift">↑</li>',after:'<li id="limeCaret" class="lime-key lime-special-key lime-caret">|↔</li>'}},i=D.verbatim.keys;e+=i.standard.map(function(e,o){var n=t["row"+o];return'<menu class="lime-key-row">'+(n&&n.before||"")+e.map(function(e,t){return'<li class="lime-key" data-text="'+e+'" data-symbol="'+i.symbol[o][t]+'"></li>'}).join("")+(n&&n.after||"")+"</menu>"}).join(""),e+='<menu class="lime-key-row"><li id="limeSymbol" class="lime-key lime-special-key">★</li><li class="lime-key lime-http" data-text="http://"></li><li class="lime-key lime-wwwdot" data-text="www."></li><li class="lime-key lime-spacebar" data-text=" ">&nbsp;</li><li class="lime-key lime-dotcom" data-text=".com"></li><li id="limeReturn" class="lime-key lime-special-key lime-return">→</li></menu>',T.innerHTML=e}function l(e){e.classList.contains("lime-key")&&(v&&v.classList.remove("lime-focus"),v=e,v.classList.add("lime-focus"))}function a(e){var t;if(v){if("left"===e||"right"===e)t=v[("left"===e?"previous":"next")+"Sibling"],t||x||(t=v.parentNode[("left"===e?"last":"first")+"Child"]);else if(!x){var i=v.getBoundingClientRect(),o=v.offsetHeight,n=i.top+("down"===e?o:-o),r=E;E||(r=E=i.left+v.offsetWidth/2),t=document.elementFromPoint("left"===L?r-10:r+10,n),t.classList.contains("lime-key")||(t=document.elementFromPoint(r+10,n))}}else t=T.querySelector(".lime-key");if(t.classList.contains("lime-key"))l(t),("left"===e||"right"===e)&&(E=v.getBoundingClientRect().left+v.offsetWidth/2,L=e);else if(x){var i=v.getBoundingClientRect();return d(),l(document.elementFromPoint(i.left,i.top)),E=i.left+v.offsetWidth/2,a(e)}}function r(){var e,t,i=v,o="toLocaleUpperCase"in String.prototype?"toLocaleUpperCase":"toUpperCase";if(t=U[i.id.slice(4)])return t(i);if(e=i.dataset[b?"symbol":"text"]||i.dataset.text){(h||w)&&(e=e[o]()),h&&(h=!1,T.classList.remove("shift-toggle"));var n=document.activeElement;if(N||B.test(n.type)){var l=n.selectionStart;n.value=n.value.slice(0,l)+e+n.value.slice(n.selectionEnd),n.selectionStart=n.selectionEnd=l+e.length}else{var a,r,s,c=window.getSelection();c.deleteFromDocument();do a=String(c).length,c.modify("extend","backward","line");while(String(c).length!==a);r=String(c),c.deleteFromDocument();do a=String(c).length,c.modify("extend","forward","line");while(String(c).length!==a);for(s=String(c),c.deleteFromDocument(),n.setAttribute("value",n.defaultValue),n.value=r+e+s,n.select(),c=window.getSelection(),c.collapseToEnd();a-->0;)c.modify("move","backward","character")}}}function s(e){e.preventDefault(),e.stopPropagation()}function c(){document.activeElement.form&&document.activeElement.form.submit(),o()}function m(){var e,t,i,o,n,l=D.verbatim.diacritics[v&&v.dataset.text];v&&l&&((e=T.querySelector(".lime-diacritics-row"))||(e=document.createElement("menu"),e.className="lime-key-row lime-diacritics-row"),T.classList.add("lime-container-dim"),v.classList.add("lime-toggle"),i=T.getBoundingClientRect(),t=v.getBoundingClientRect(),o=v.parentNode.lastChild.getBoundingClientRect(),e.innerHTML="",Array.prototype.forEach.call(l,function(t){var i=e.appendChild(document.createElement("li"));i.className="lime-key lime-diacritical",i.dataset.text=t}),T.appendChild(e),x=e,n=e.offsetWidth,e.style.left=e.style.right="",t.right+n<=o.right?e.style.left=t.right-i.left+"px":e.style.right=i.right-t.left+"px",e.style.top=t.top-i.top+"px",e.style.width=0,window.setTimeout(function(){e.style.width=n+"px"}))}function d(){x&&(x.parentNode.removeChild(x),T.classList.remove("lime-container-dim"),l(T.querySelector(".lime-toggle[data-text]")),v.classList.remove("lime-toggle"),E=v.getBoundingClientRect().left,x=null)}function u(){var e,t,i=document.activeElement,o=Array.prototype.slice.call((i.form||document).getElementsByTagName("*"));for(o=o.filter(function(e){return e.tabIndex>-1&&e.offsetHeight&&!e.disabled}),o.sort(function(e,t){return(e.tabIndex||Number.MAX_VALUE)-(t.tabIndex||Number.MAX_VALUE)}),t=o.indexOf(i),o=o.slice(t+1).concat(o.slice(0,t)),t=0;document.activeElement!=e&&o.length;)e=o.shift(),e.focus()}function f(e){var t;return R?t=new CustomEvent(e,{bubbles:!0,cancelable:!0}):(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0)),document.activeElement.dispatchEvent(t)}function g(e){var t=/^(?:text|email|number|password|tel|url|search)$/;return(t.test(e.type)||e.isContentEditable)&&!e.readOnly}var y,p,v,h,w,b,k,E,L,x,C=document.createElement("style"),T=document.createElement("div"),S=e.keyLime||{config:{}},K=!1,R=function(){try{return!!new CustomEvent("a")}catch(e){return!1}}(),A=[".lime-container { background-color: #333; position: absolute; bottom: 0; left: 0; right: 0; color: #fff; z-index:1000000; font-family: sans-serif; }",'.lime-container-dim::before { position: absolute; content: ""; top: 0; left: 0; right: 0; bottom: 0; background-color: #000; opacity: 0.5; }',".lime-key-row { list-style-type: none; clear: both; text-align: center; padding: 0; margin: 0; font-size: 28px; }",".lime-diacritics-row { position: absolute; z-index: 2; overflow: hidden; -webkit-transition: width 400ms; transition: width 400ms; white-space: nowrap; }",".lime-key { vertical-align: top; display: inline-block; border: 3px solid #333; background-color: #666; width: 66px; line-height: 50px; -webkit-transition: all 400ms linear; transition: all 400ms linear; }",".lime-key[data-text]::before { content: attr(data-text) }",".lime-container.symbol-toggle .lime-key[data-symbol]::before { content: attr(data-symbol) }",".lime-container.shift-toggle .lime-key[data-text]:not(.lime-http):not(.lime-dotcom):not(.lime-wwwdot)::before { text-transform: uppercase; }",".lime-special-key { background-color: #999; color: #333; }",".lime-return { background-color: #ccc; width: 138px; }",".lime-focus { background-color: #26f; color: #fff; }",".lime-toggle { background-color: #2f2; color: #fff; position: relative; }",".lime-spacebar { width:498px; }",".lime-http, .lime-dotcom, .lime-wwwdot { font-size: 20px; }"],B=/^(?:text|search|url|tel|password)$/i,N=t(),U={Tab:u,Return:c,Shift:function(e){var t=T.querySelector(".lime-toggle");t&&t.classList.remove("lime-toggle"),T.classList.remove("shift-toggle","symbol-toggle"),b=k=!1,h?(h=!1,w=!0,e.classList.add("lime-toggle")):w?w=!1:h=!0,(h||w)&&T.classList.add("shift-toggle")},Symbol:function(e){var t=T.querySelector(".lime-toggle");t&&t.classList.remove("lime-toggle"),b=!b,h=w=k=!1,T.classList.remove("shift-toggle"),T.classList.toggle("symbol-toggle"),b&&e.classList.toggle("lime-toggle")},Backspace:function(){var e=document.activeElement,t=window.getSelection();if(g(e))if(N||B.test(e.type)){var i=e.selectionStart;String(t).length?(e.value=e.value.slice(0,i)+e.value.slice(e.selectionEnd),e.selectionStart=i):(e.value=e.value.slice(0,i-1)+e.value.slice(i),e.selectionStart=i-1)}else String(t).length||t.modify("extend","backward","character"),t.deleteFromDocument()},Caret:function(e){var t=T.querySelector(".lime-toggle");t&&t.classList.remove("lime-toggle"),b=h=w=!1,T.classList.remove("shift-toggle","symbol-toggle"),k=!k,k&&e.classList.add("lime-toggle")}},D={verbatim:{keys:{standard:[["@","1","2","3","4","5","6","7","8","9","0","-","="],["q","w","e","r","t","y","u","i","o","p","[","]"],["a","s","d","f","g","h","j","k","l",";","'"],["z","x","c","v","b","n","m",",",".","/"]],symbol:[["@","1","2","3","4","5","6","7","8","9","0","-","="],["~","#","`","£","$","%","^","&","(",")","[","]"],["•","€","¥","¡","¿","*","|","{","}",":","&quot;"],["_","+","!","\\","«","»","§","<",">","?"]]},diacritics:{a:"äáâàåæ",c:"ç©",d:"ð",e:"ëéêè",i:"ïíîì",m:"µ",n:"ñ",o:"öóôòõø",u:"üúûù",y:"ÿý"}}};T.className="lime-container",T.lang="en",document.head.insertBefore(C,document.head.firstChild);for(var P=0;P<A.length;P++)C.sheet.insertRule(A[P],P);return document.addEventListener("focus",function(e){var t=e.target.tagName;S.config.noauto||!e.target.isContentEditable&&"INPUT"!==t&&"TEXTAREA"!==t||i()},!0),document.addEventListener("blur",function(){K&&!S.config.noauto&&o()},!0),document.addEventListener("keydown",function(e){if(K){var t=e.key.replace(/^Arrow/,"");switch(t){case"Left":case"Right":case"Up":case"Down":if(k)return;s(e),a(t.toLowerCase());break;case"Enter":y||(y=setTimeout(m,S.config.keyHoldTimeout||500)),s(e);break;case"Escape":case"BrowserBack":s(e),k?U.Caret(v):x?d():o()}}},!0),document.addEventListener("keypress",function(e){if(0!==e.charCode){var t=String.fromCharCode(e.keyCode).toLowerCase(),i=T.querySelector('li[data-text="'+t+'"]');i&&(l(i),window.setTimeout(function(){i.classList.remove("lime-focus")},100))}},!0),document.addEventListener("keyup",function(e){if(K&&v)switch(e.key.replace(/^Arrow/,"")){case"Escape":case"BrowserBack":case"Up":case"Down":case"Left":case"Right":s(e);break;case"Enter":s(e),clearTimeout(y),y=null,x&&!v.classList.contains("lime-diacritical")?l(x.firstChild):(r(),x&&d())}},!0),T.addEventListener("mousedown",function(e){s(e),e.target.classList.contains("lime-key")&&(y=setTimeout(m,S.config.keyHoldTimeout||500))},!0),T.addEventListener("mouseup",function(e){s(e),e.target.classList.contains("lime-key")&&(clearTimeout(y),y=null,r(),x&&d())},!0),T.addEventListener("mousemove",function(e){l(e.target)}),T.addEventListener("mouseout",function(e){v===e.target&&v.classList.remove("lime-focus")}),function(){var t={13:"Enter",27:"Escape",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown"},i={get:function(){var e=this.which;return t[e]||"Unidentified"}};e.TvKeyCode?(t[TvKeyCode.RETURN]="BrowserBack",t[TvKeyCode.ENTER]="Enter",t[TvKeyCode.UP]="ArrowUp",t[TvKeyCode.DOWN]="ArrowDown",t[TvKeyCode.LEFT]="ArrowLeft",t[TvKeyCode.RIGHT]="ArrowRight"):e.KeyEvent&&e.KeyEvent.VK_ENTER&&(t[e.KeyEvent.VK_BACK]="BrowserBack",t[e.KeyEvent.VK_ENTER]="Enter"),e.KeyboardEvent&&!e.KeyboardEvent.prototype.hasOwnProperty("key")&&Object.defineProperty(e.KeyboardEvent.prototype,"key",i),e.KeyEvent&&e.KeyEvent.prototype&&!e.KeyEvent.prototype.hasOwnProperty("key")&&Object.defineProperty(e.KeyEvent.prototype,"key",i)}(e),n(),S.show=i,S.hide=o,S});